{"version":3,"file":"yetanotherstore.js","sources":["../node_modules/@jonathanlurie/eventmanager/es/eventmanager.js","../src/Store.js"],"sourcesContent":["/**\n * This is borrowed from https://gist.github.com/jed/982883\n * because the uuid most popular package is using a node dep\n */\n\nfunction uuidv4(a){\n  return a?(a^Math.random()*16>>a/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,uuidv4)\n}\n\n/**\n * The EventManager deals with events, create them, call them.\n * This class is mostly for being inherited from.\n */\nclass EventManager {\n  /**\n   * Constructor\n   * @param {boolean} enabled - if true (default), the events emitting is enabled, if false, they won't be fired.\n   */\n  constructor(enabled=true) {\n    this._events = {};\n    this._enabled = enabled;\n\n    // by event hash, stores the even name and the callback, in order to remove it\n    // efficiently\n    this._eventIndex = {};\n  }\n\n\n  /**\n   * This way, the events are not emitted\n   */\n  disableEvents() {\n    this._enabled = false;\n  }\n\n\n  /**\n   * This way, the events are properly emitted\n   */\n  enableEvents() {\n    this._enabled = true;\n  }\n\n  /**\n   * Define an event, with a name associated with a function\n   * @param  {String} eventName - Name to give to the event\n   * @param  {Function} callback - function associated to the even\n   * @return {string|null} the eventId (useful to remove it) or null if the event couldnt be added\n   */\n  on(eventName, callback) {\n    if (typeof callback === 'function') {\n      if (!(eventName in this._events)) {\n        this._events[eventName] = [];\n      }\n\n      let eventId = uuidv4();\n      this._eventIndex[eventId] = {\n        eventName: eventName,\n        callback: callback\n      };\n\n      this._events[eventName].push(eventId);\n\n      return eventId\n    } else {\n      console.warn('The callback must be of type Function');\n    }\n\n    return null\n  }\n\n\n  emit(eventName, args = []) {\n    if(!this._enabled){\n      return\n    }\n\n    // the event must exist and be non null\n    if ((eventName in this._events) && (this._events[eventName].length > 0)) {\n      const events = this._events[eventName];\n      for (let i = 0; i < events.length; i += 1) {\n        this._eventIndex[events[i]].callback(...args);\n      }\n    }\n  }\n\n\n  /**\n   * Delete an event using its id\n   * @param {string} id - id of the event (returned by the `.on()` method)\n   */\n  delete(eventId) {\n    if(!(eventId in this._eventIndex)){\n      console.log(`No event of id ${eventId}.`);\n      return\n    }\n\n    // array of events of the same name as eventId\n    let eventOfSameName = this._events[this._eventIndex[eventId].eventName];\n    let index = eventOfSameName.indexOf(eventId);\n\n    delete this._eventIndex[eventId];\n\n    if(index !== -1) {\n      eventOfSameName.splice(index, 1);\n    }\n  }\n\n\n}\n\nexport default EventManager;\n//# sourceMappingURL=eventmanager.js.map\n","import EventManager from '@jonathanlurie/eventmanager'\n\n\n/**\n * A store is a place to store 'key:value' tuples. A key is generally a string\n * and unique identifier within the store. The value can be anything.\n *\n * This store provides some events, such as 'valueSet', 'set:{key}', 'valueDeleted',\n * 'del:{key}' and 'reseted'. Those event can be subscribed to with the following:\n * ```js\n * myStoreInstance.on( THE_EVENT_NAME, (val) => {\n *   // do something\n * })\n * ```\n */\nclass Store extends EventManager {\n\n  constructor(){\n    super()\n    this._storage = {}\n    this._gateKeeper = null\n    this._locked = false\n  }\n\n\n  /**\n   * Add or update a value in the store, under the name of the key.\n   * Throw the events:\n   *   - 'valueDeleted' with the argument {key: string, value: any, previousValue: any}\n   *   - 'set:{key}' where {key} is the key as a string, with the argument {key: string, value: any, previousValue: any}\n   * @param {string|number} key - identifier of the value\n   * @param {any} value - the value\n   * @param {boolean} forceLock - bypass the locked after the .lock() methods was called.\n   * @return {string} the key as a string\n   */\n  set(key, value, forceLock = false){\n    if(this._locked && !forceLock){\n      return\n    }\n\n    if(typeof key === 'object'){\n      throw new Error('Keys cannot be object')\n      return\n    }\n\n    let validKey = key.toString()\n    let argObj = {\n      key: validKey,\n      value: value\n    }\n\n    if(this._gateKeeper){\n      let isValid = this._gateKeeper(key, value)\n      if(!isValid){\n        return this.emit('refused', [argObj])\n      }\n    }\n\n    argObj.previousValue = this._storage[validKey] // possibly undefined\n    this._storage[validKey] = value\n    this.emit('valueSet', [argObj])\n    this.emit(`set:${validKey}`, [argObj])\n    return validKey\n  }\n\n\n\n  /**\n   * Retrieve the value corresponding to the 'key'\n   * @param {string|number} key - identifier of the value\n   * @return {any|undefined} the value, possibly 'undefined' if not in store\n   */\n  get(key){\n    let validKey = key.toString()\n    return this._storage[validKey]\n  }\n\n\n  /**\n   * Delete a value from the store, using its key as identifier.\n   * Throw the events:\n   *   - 'valueDeleted' with the argument {key: string, value: any}\n   *   - 'del:{key}' where {key} is the key as a string, with the argument {key: string, value: any}\n   * @param {string|number} key - identifier of the value\n   * @return {boolean} true if the value was successfully deleted, false if not (because not found)\n   */\n  delete(key){\n    let validKey = key.toString()\n    if(validKey in this._storage){\n      argObj = {\n        key: validKey,\n        value: value\n      }\n\n      delete this._storage[validKey]\n      this.emit('valueDeleted', [argObj])\n      this.emit(`del:${validKey}`, [argObj])\n      return true\n    }\n\n    return false\n  }\n\n\n  /**\n   * Check if a given key is in the store\n   * @param {string|number} key - identifier of the value\n   * @return {boolean} true if is in store, false if not\n   */\n  has(key){\n    return (key.toString() in this._storage)\n  }\n\n\n  /**\n   * Flush the store, remove everything.\n   * Throw the event 'reseted' with no argument.\n   */\n  reset(){\n    this._storage = {}\n    this.emit('reseted', [])\n  }\n\n\n  /**\n   * Get all the keys in the store\n   * @return {Array} array of strings\n   */\n  keys(){\n    return Object.keys(this._storage)\n  }\n\n\n  /**\n   * Get all the values from the store, without the keys\n   * @return {Array}\n   */\n  values(){\n    return Object.values(this._storage)\n  }\n\n\n  /**\n   * Define the gate keeper function.\n   * This function is a data validator for the .set method. It takes two arguments\n   * (the key and the value of the piece of data to add) and returns true (valid to be added)\n   * of false (not valid to be added). If the object is non valid to be added, then the event\n   * 'refused' is emitted, with the arg {key, value}.\n   * If the gatekeeper function is no set or set to null, the feature is not used and no\n   * control will happen on the call of the .set method/\n   * @param {function|null} fn - the gatekeeper function\n   */\n  setGateKeeper(fn){\n    if(typeof fn === 'function' || fn === null){\n      this._gateKeeper = fn\n    }\n  }\n\n\n  /**\n   * Check if the store is locked\n   * @return {boolean}\n   */\n  isLocked(){\n    return this._locked\n  }\n\n\n  /**\n   * Lock the store, so that the .set method cannot be used unless the\n   * arg forceLock is set to true.\n   */\n  lock(){\n    this._locked = true\n  }\n\n\n  /**\n   * No longer use the lock\n   */\n  unlock(){\n    this._locked = false\n  }\n\n}\n\nexport default Store\n"],"names":[],"mappings":"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"}